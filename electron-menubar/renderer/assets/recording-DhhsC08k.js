import{r as a,j as r,a as h,R as I,b as P}from"./globals-B-VILdgX.js";import{C as j,X as v}from"./x-B4rIwNK5.js";import{M as C}from"./mic-ChiTkcKE.js";function k(){const[s,i]=a.useState("idle"),[A,N]=a.useState("⌘⇧R"),[w,R]=a.useState(null),l=a.useRef(null),m=a.useRef([]),d=a.useRef(null),u=a.useRef(null),f=a.useRef(null),g=a.useRef([]),p=a.useRef(!0);a.useEffect(()=>{window.electronAPI.getPlatform().then(e=>{N(e.isMac?"⌘⇧R":"Ctrl+Shift+R")}),window.electronAPI.onRecordingStart(async()=>{try{const e=await window.electronAPI.getSettings();p.current=e.beepEnabled!==!1}catch{p.current=!0}p.current&&b(800,.12),i("recording"),T()}),window.electronAPI.onRecordingStop(()=>{M()}),window.electronAPI.onStatusUpdate(({status:e})=>{e==="transcribing"?i("processing"):e==="polishing"?i("polishing"):e==="done"?i("done"):e==="error"&&i("error")}),window.electronAPI.onAgentSwitched(({name:e})=>{R(e),setTimeout(()=>R(null),1200)})},[]);const b=(e,c)=>{try{const t=new AudioContext,n=t.createOscillator(),o=t.createGain();n.connect(o),o.connect(t.destination),n.frequency.value=e,n.type="sine",o.gain.setValueAtTime(.3,t.currentTime),o.gain.exponentialRampToValueAtTime(.01,t.currentTime+c),n.start(t.currentTime),n.stop(t.currentTime+c)}catch(t){console.error("Beep failed",t)}},B=e=>{d.current=new AudioContext,u.current=d.current.createAnalyser(),d.current.createMediaStreamSource(e).connect(u.current),u.current.fftSize=32;const t=new Uint8Array(u.current.frequencyBinCount),n=()=>{f.current=requestAnimationFrame(n),u.current?.getByteFrequencyData(t),g.current.forEach((o,x)=>{if(o){const y=t[x+2]||0,E=Math.max(4,y/255*24);o.style.height=`${E}px`}})};n()},S=()=>{f.current&&(cancelAnimationFrame(f.current),f.current=null),d.current&&(d.current.close(),d.current=null),g.current.forEach(e=>{e&&(e.style.height="4px")})},T=async()=>{try{const e=await navigator.mediaDevices.getUserMedia({audio:!0});B(e);const c="audio/webm;codecs=opus",t=MediaRecorder.isTypeSupported(c)?c:void 0,n=new MediaRecorder(e,t?{mimeType:t,audioBitsPerSecond:128e3}:void 0);m.current=[],n.ondataavailable=o=>{o.data.size>0&&m.current.push(o.data)},n.onstop=async()=>{if(e.getTracks().forEach(y=>y.stop()),S(),m.current.length===0)return;const x=await new Blob(m.current,{type:"audio/webm"}).arrayBuffer();window.electronAPI.sendAudio(x)},n.start(1e3),l.current=n}catch(e){console.error("Mic error:",e),i("error")}},M=()=>{l.current&&l.current.state!=="inactive"&&(l.current.stop(),p.current&&b(400,.12),i("processing"))};return r.jsxs("div",{className:"flex items-center justify-center h-screen",children:[w&&r.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 animate-fade-in",children:r.jsx("div",{className:"bg-primary text-primary-foreground px-4 py-2 rounded-full text-sm font-medium shadow-lg",children:w})}),r.jsxs("div",{className:h("flex items-center gap-2 px-3 py-2 rounded-2xl backdrop-blur-xl border shadow-lg","bg-card/95 border-border/50",s==="recording"&&"border-primary/50",s==="error"&&"border-destructive/50"),children:[r.jsx("div",{className:h("w-8 h-8 rounded-lg flex items-center justify-center","bg-gradient-to-br from-primary to-primary/80",s==="processing"&&"animate-pulse",s==="error"&&"bg-gradient-to-br from-destructive to-destructive/80"),children:s==="done"?r.jsx(j,{className:"w-4 h-4 text-primary-foreground"}):s==="error"?r.jsx(v,{className:"w-4 h-4 text-destructive-foreground"}):r.jsx(C,{className:"w-4 h-4 text-primary-foreground"})}),s==="recording"&&r.jsx("div",{className:"flex items-center gap-0.5 h-6",children:[0,1,2,3,4].map(e=>r.jsx("div",{ref:c=>{g.current[e]=c},className:"w-0.5 bg-gradient-to-t from-primary to-primary/60 rounded-full transition-all duration-50",style:{height:"4px"}},e))}),(s==="processing"||s==="polishing")&&r.jsx("div",{className:"flex items-center gap-1",children:[0,1,2].map(e=>r.jsx("div",{className:h("w-1 h-1 rounded-full animate-bounce",s==="polishing"?"bg-purple-400":"bg-primary"),style:{animationDelay:`${e*.2}s`}},e))}),s==="done"&&r.jsx(j,{className:"w-5 h-5 text-primary animate-fade-in"}),s==="error"&&r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(v,{className:"w-4 h-4 text-destructive"}),r.jsx("span",{className:"text-xs text-muted-foreground",children:r.jsx("kbd",{className:"px-1 py-0.5 rounded bg-muted text-xs font-mono",children:A})})]})]})]})}I.createRoot(document.getElementById("root")).render(r.jsx(P.StrictMode,{children:r.jsx(k,{})}));
